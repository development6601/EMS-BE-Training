openapi: 3.0.3
info:
  title: Event Management Backend API
  description: |
    A comprehensive backend API for event management system with user authentication, 
    event management, and participant tracking.
    
    ## Features
    - User registration and authentication
    - JWT-based access control with refresh tokens
    - Role-based authorization (Admin/User)
    - Rate limiting and security middleware
    - Comprehensive input validation
    
    ## Authentication
    The API uses JWT (JSON Web Tokens) for authentication. Include the access token 
    in the Authorization header for protected endpoints:
    ```
    Authorization: Bearer <access_token>
    ```
    
    ## Rate Limiting
    Authentication endpoints have rate limiting:
    - 100 requests per 15 minutes per IP address
    - Exceeding limits returns HTTP 429
    
    ## Test Credentials
    After running the seed script, you can use these test accounts:
    - **Admin**: admin@eventmanagement.com / Admin123!
    - **User**: john.doe@example.com / Password123!
  version: 1.0.0
  contact:
    name: API Support
    email: support@eventmanagement.com
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: http://localhost:5000
    description: Development server
  - url: https://api.eventmanagement.com
    description: Production server

tags:
  - name: Authentication
    description: User authentication and authorization endpoints
  - name: Health
    description: System health and status endpoints

paths:
  /health:
    get:
      tags:
        - Health
      summary: Health Check
      description: Check if the server is running and healthy
      responses:
        '200':
          description: Server is healthy
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthResponse'
              example:
                success: true
                message: Server is running
                timestamp: '2024-01-15T10:30:00.000Z'

  /api:
    get:
      tags:
        - Health
      summary: API Information
      description: Get basic API information and available endpoints
      responses:
        '200':
          description: API information retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiInfoResponse'

  /api/auth/register:
    post:
      tags:
        - Authentication
      summary: Register New User
      description: Create a new user account with email and password
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegisterRequest'
            example:
              email: john.doe@example.com
              password: Password123!
              firstName: John
              lastName: Doe
              dateOfBirth: '1990-05-15'
              gender: male
              phone: '+1234567890'
              bio: 'Software developer passionate about technology'
              website: 'https://johndoe.dev'
              socialMedia:
                linkedin: 'https://linkedin.com/in/johndoe'
                twitter: 'https://twitter.com/johndoe'
                instagram: 'https://instagram.com/johndoe'
              address:
                street: '123 Main St'
                city: 'New York'
                state: 'NY'
                zipCode: '10001'
                country: 'United States'
              preferences:
                emailNotifications: true
                smsNotifications: false
                marketingEmails: false
                theme: auto
                language: en
      responses:
        '201':
          description: User registered successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '400':
          description: Validation error or user already exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '429':
          description: Too many requests
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/auth/login:
    post:
      tags:
        - Authentication
      summary: User Login
      description: Authenticate user with email and password
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
            example:
              email: john.doe@example.com
              password: Password123!
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Invalid credentials or account blocked
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '429':
          description: Too many requests
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/auth/refresh:
    post:
      tags:
        - Authentication
      summary: Refresh Access Token
      description: Get a new access token using a valid refresh token
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RefreshTokenRequest'
      responses:
        '200':
          description: Token refreshed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RefreshTokenResponse'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Invalid or expired refresh token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/auth/logout:
    post:
      tags:
        - Authentication
      summary: Logout User
      description: Logout user by invalidating the refresh token
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LogoutRequest'
      responses:
        '200':
          description: Logout successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '401':
          description: Unauthorized - Invalid or missing access token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'


  /api/auth/me:
    get:
      tags:
        - Authentication
      summary: Get Current User Profile
      description: Get the profile information of the currently authenticated user
      security:
        - bearerAuth: []
      responses:
        '200':
          description: User profile retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserProfileResponse'
        '401':
          description: Unauthorized - Invalid or missing access token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: User not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT access token obtained from login or refresh endpoints

  schemas:
    User:
      type: object
      properties:
        _id:
          type: string
          description: Unique user identifier
          example: 507f1f77bcf86cd799439011
        email:
          type: string
          format: email
          description: User's email address
          example: john.doe@example.com
        firstName:
          type: string
          description: User's first name
          minLength: 2
          maxLength: 50
          example: John
        lastName:
          type: string
          description: User's last name
          minLength: 2
          maxLength: 50
          example: Doe
        dateOfBirth:
          type: string
          format: date
          description: User's date of birth
          example: '1990-01-15'
        gender:
          type: string
          enum: [male, female, other, prefer-not-to-say]
          description: User's gender
          example: prefer-not-to-say
        role:
          type: string
          enum: [admin, user]
          description: User's role in the system
          example: user
        isBlocked:
          type: boolean
          description: Whether the user account is blocked
          example: false
        phone:
          type: string
          description: User's phone number
          pattern: '^[\+]?[1-9][\d]{0,15}$'
          example: '+1234567890'
        bio:
          type: string
          maxLength: 500
          description: User's biography
          example: 'Software developer passionate about technology'
        website:
          type: string
          format: uri
          description: User's personal website
          example: 'https://johndoe.com'
        socialMedia:
          $ref: '#/components/schemas/SocialMedia'
        address:
          $ref: '#/components/schemas/Address'
        preferences:
          $ref: '#/components/schemas/UserPreferences'
        lastLoginAt:
          type: string
          format: date-time
          nullable: true
          description: Last login timestamp
          example: '2024-01-15T10:30:00.000Z'
        loginCount:
          type: integer
          description: Total number of logins
          example: 5
        createdAt:
          type: string
          format: date-time
          description: User creation timestamp
          example: '2024-01-15T10:30:00.000Z'
        updatedAt:
          type: string
          format: date-time
          description: User last update timestamp
          example: '2024-01-15T10:30:00.000Z'
      required: [_id, email, firstName, lastName, role, isBlocked]

    Address:
      type: object
      properties:
        street:
          type: string
          description: Street address
          maxLength: 100
          example: 123 Main Street
        city:
          type: string
          description: City name
          maxLength: 50
          example: New York
        state:
          type: string
          description: State or province
          maxLength: 50
          example: NY
        zipCode:
          type: string
          description: ZIP or postal code
          maxLength: 10
          example: '10001'
        country:
          type: string
          description: Country name
          maxLength: 50
          example: 'United States'

    SocialMedia:
      type: object
      properties:
        linkedin:
          type: string
          format: uri
          description: LinkedIn profile URL
          example: 'https://linkedin.com/in/johndoe'
        twitter:
          type: string
          format: uri
          description: Twitter profile URL
          example: 'https://twitter.com/johndoe'
        instagram:
          type: string
          format: uri
          description: Instagram profile URL
          example: 'https://instagram.com/johndoe'

    UserPreferences:
      type: object
      properties:
        emailNotifications:
          type: boolean
          description: Enable email notifications
          example: true
        smsNotifications:
          type: boolean
          description: Enable SMS notifications
          example: false
        marketingEmails:
          type: boolean
          description: Enable marketing emails
          example: false
        theme:
          type: string
          enum: [light, dark, auto]
          description: UI theme preference
          example: auto
        language:
          type: string
          maxLength: 5
          description: Language preference code
          example: en

    RegisterRequest:
      type: object
      properties:
        email:
          type: string
          format: email
          description: User's email address
          example: john.doe@example.com
        password:
          type: string
          minLength: 6
          description: User's password
          example: Password123!
        firstName:
          type: string
          minLength: 2
          maxLength: 50
          description: User's first name
          example: John
        lastName:
          type: string
          minLength: 2
          maxLength: 50
          description: User's last name
          example: Doe
        dateOfBirth:
          type: string
          format: date
          description: User's date of birth (optional)
          example: '1990-01-15'
        gender:
          type: string
          enum: [male, female, other, prefer-not-to-say]
          description: User's gender (optional)
          example: prefer-not-to-say
        phone:
          type: string
          pattern: '^[\+]?[1-9][\d]{0,15}$'
          description: User's phone number (optional)
          example: '+1234567890'
        bio:
          type: string
          maxLength: 500
          description: User's biography (optional)
          example: 'Software developer passionate about technology'
        website:
          type: string
          format: uri
          description: User's personal website (optional)
          example: 'https://johndoe.com'
        socialMedia:
          $ref: '#/components/schemas/SocialMedia'
        address:
          $ref: '#/components/schemas/Address'
        preferences:
          $ref: '#/components/schemas/UserPreferences'
      required: [email, password, firstName, lastName]

    LoginRequest:
      type: object
      properties:
        email:
          type: string
          format: email
          description: User's email address
          example: john.doe@example.com
        password:
          type: string
          description: User's password
          example: Password123!
      required: [email, password]

    RefreshTokenRequest:
      type: object
      properties:
        refreshToken:
          type: string
          description: Valid refresh token
          example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
      required: [refreshToken]

    LogoutRequest:
      type: object
      properties:
        refreshToken:
          type: string
          description: Refresh token to invalidate
          example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
      required: [refreshToken]

    AuthResponse:
      type: object
      properties:
        success:
          type: boolean
          description: Indicates if the request was successful
          example: true
        message:
          type: string
          description: Response message
          example: User registered successfully
        data:
          type: object
          properties:
            user:
              $ref: '#/components/schemas/User'
            accessToken:
              type: string
              description: JWT access token (expires in 15 minutes)
              example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
            refreshToken:
              type: string
              description: JWT refresh token (expires in 7 days)
              example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
          required: [user, accessToken, refreshToken]
      required: [success, message, data]

    RefreshTokenResponse:
      type: object
      properties:
        success:
          type: boolean
          description: Indicates if the request was successful
          example: true
        message:
          type: string
          description: Response message
          example: Token refreshed successfully
        data:
          type: object
          properties:
            accessToken:
              type: string
              description: New JWT access token (expires in 15 minutes)
              example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
            refreshToken:
              type: string
              description: New JWT refresh token (expires in 7 days)
              example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
          required: [accessToken, refreshToken]
      required: [success, message, data]

    UserProfileResponse:
      type: object
      properties:
        success:
          type: boolean
          description: Indicates if the request was successful
          example: true
        message:
          type: string
          description: Response message
          example: User profile retrieved successfully
        data:
          type: object
          properties:
            user:
              $ref: '#/components/schemas/User'
          required: [user]
      required: [success, message, data]

    SuccessResponse:
      type: object
      properties:
        success:
          type: boolean
          description: Indicates if the request was successful
          example: true
        message:
          type: string
          description: Response message
          example: Operation completed successfully
      required: [success, message]

    ErrorResponse:
      type: object
      properties:
        success:
          type: boolean
          description: Indicates if the request was successful
          example: false
        message:
          type: string
          description: Error message
          example: An error occurred
        errors:
          type: string
          description: Detailed error information (for validation errors)
          example: Email is required, Password must be at least 6 characters long
      required: [success, message]

    HealthResponse:
      type: object
      properties:
        success:
          type: boolean
          description: Indicates if the server is healthy
          example: true
        message:
          type: string
          description: Health status message
          example: Server is running
        timestamp:
          type: string
          format: date-time
          description: Current server timestamp
          example: '2024-01-15T10:30:00.000Z'
      required: [success, message, timestamp]

    ApiInfoResponse:
      type: object
      properties:
        success:
          type: boolean
          description: Indicates if the request was successful
          example: true
        message:
          type: string
          description: API information message
          example: Event Management API
        version:
          type: string
          description: API version
          example: 1.0.0
        endpoints:
          type: object
          properties:
            auth:
              type: string
              description: Authentication endpoints
              example: /api/auth
            health:
              type: string
              description: Health check endpoint
              example: /health
      required: [success, message, version, endpoints]
